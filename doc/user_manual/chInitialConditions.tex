
\chapter{Initial Conditions for Tracking} \label{InitCondTrack}

For the study of non-linear systems, the choice of initial conditions is of crucial importance.\index{initial conditions}
The input structure for the initial conditions was therefore organised in such a way as to allow for maximum flexibility.
SixTrack is optimised to reach the largest possible number of turns.
In order to derive the Lyapunov exponent\index{Lyapunov exponent}, and thereby to distinguish between regular and chaotic motion, the particle has a close by companion particle.
Moreover, experience has shown that varying only the amplitude while keeping the phases constant is sufficient to understand the non-linear dynamics, as a subsequent detailed post-processing allows to find the dependence of the parameter of interest on these phases.

A number of features have over time been deprecated or replaced by other modules in SixTrack.
Therefore there are a number of parameters that are no longer in use, but nevertheless have to be set to dummy values.
The Simulation (\texttt{SIMU}) and Distribution (\texttt{DIST}) blocks are intended to replace all of the blocks in this chapter.
These blocks take keyword/value sets instead of blocks of numbers, and are therefore easier to maintain.
The \texttt{SIMU} block (Section~\ref{Input:SIMU}) can currently be used to replace the \texttt{TRAC}, \texttt{INIT}, and \texttt{HION} blocks (Section~\ref{TraPar}), but note that the implementation may still have bugs, and is therefore considered experimental\index{SIMU}.

% ================================================================================================================================ %
\section{Simulation Parameters} \label{Input:SIMU}

\textcolor{notered}{\textbf{Note:} This input block is experimental. It provides an alternative interface to the most used parameters of the \texttt{TRAC}, \texttt{INIT}, and \texttt{HION} blocks, and is intended to be used in combination with the \texttt{DIST} block.}

\bigskip
The Simulation block (\texttt{SIMU}) is intended to take the main simulation parameters, and replaces the \texttt{TRAC}, \texttt{INTI}, and \texttt{HION} blocks\index{SIMU}\index{Simualtion Block}.
If the \texttt{SIMU} block is present in \texttt{fort.3}, these blocks cannot be present.

If the reference particle mass is set in the \texttt{SIMU} block, the value provided in the \texttt{SYNC} block is ignored.

\bigskip
\begin{tabular}{@{}lp{0.7\linewidth}}
    \textbf{Keyword}    & \texttt{SIMU}\index{SIMU} \\
    \textbf{Data lines} & Variable \\
    \textbf{Format}     & Keyword/value format. See Table~\ref{Table:SIMU}.
\end{tabular}

\bigskip
Some settings provided by the \texttt{TRAC} and \texttt{INIT} blocks are not supported by the \texttt{SIMU} block.
These are listed below.
The option to add closed orbit to generated particles is only supported for the amplitude scan, which is not supported by the \texttt{SIMU} block.
If you need this feature, please use the old input format.

\bigskip
\begin{tabular}{@{}llp{0.7\linewidth}}
    \texttt{TRAC} & \texttt{ntwin}          & Fixed to a value of 2.\\
    \texttt{TRAC} & \texttt{idy(1), idy(2)} & Fixed to a value of 1.\\
    \texttt{TRAC} & \texttt{idfor}          & Fixed to a value of 1.\\
    \texttt{TRAC} & \texttt{amp(1), amp0}   & Fixed to a value of 0.\\
\end{tabular}

\begin{center}
\setlength\LTleft{0pt}
\setlength\LTright{0pt}
\begin{longtable}{@{\extracolsep{\fill}}|l|p{10cm}|l|}
    \caption{Available arguents in the SIMU block.}
    \label{Table:SIMU} \\*
    \hline
    \rowcolor{blue!30}
    \textbf{Keyword} & \textbf{Argument(s)} & \textbf{Default} \\*
    \hline
    \endfirsthead

    \hline
    \rowcolor{blue!30}
    \textbf{Keyword} & \textbf{Argument(s)} & \textbf{Default} \\*
    \endhead

    \rowcolor{gray!15}
    \multicolumn{3}{|c|}{(The table continues on the next page)}\\*
    \hline
    \endfoot

    \hline
    \endlastfoot

    \rowcolor{blue!15}
    \multicolumn{3}{|c|}{\textbf{Particles and Turns}}\\*
    \hline

    \rowcolor{gray!15}
    \texttt{PARTICLES} & \texttt{n\_particles(int)} & \texttt{0}\\*
    \hline
    \multicolumn{3}{|>{\raggedright}p{\textwidth}|}{%
        The number of particles to be tracked.
        The value must be an even number.
        This is due to several parts of SixTrack dealing with particles as pairs.
        \index{particles}
    } \\*
    \hline

    \rowcolor{gray!15}
    \texttt{TURNS} & \texttt{forward(int) [backward(int)]} & \texttt{0 0} \\*
    \hline
    \multicolumn{3}{|>{\raggedright}p{\textwidth}|}{%
        The number of turns in the forward, and optionally, backward direction.
        \index{turns}
    } \\*
    \hline

    \rowcolor{gray!15}
    \texttt{CRPOINT} & \texttt{interval(int)} & \texttt{1000} \\*
    \hline
    \multicolumn{3}{|>{\raggedright}p{\textwidth}|}{%
        How often to write checkpoint files.
        This parameter is ignored if SixTrack was not built with checkpoint/restart functionality.
        Checkpoint files are always written on turn 1, then with the interval specified here, and then a last time at the end of tracking.
        \index{checkpoint/restart}\index{CR}
    } \\*

    \hline
    \rowcolor{blue!15}
    \multicolumn{3}{|c|}{\textbf{Reference Particle}}\\*
    \hline

    \rowcolor{gray!15}
    \texttt{REF\_ENERGY} & \texttt{energy(float,MeV)} & \texttt{0.0}\\*
    \hline
    \multicolumn{3}{|>{\raggedright}p{\textwidth}|}{%
        The reference particle energy in MeV.
        \index{reference particle}\index{reference energy}
    } \\*
    \hline

    \rowcolor{gray!15}
    \texttt{REF\_PARTICLE} & \texttt{mass(float,MeV) [charge A Z]} & \texttt{938.271998 1 1 1}\\*
    \hline
    \rowcolor{gray!15}
    \texttt{REF\_PARTICLE} & \texttt{name [charge A Z]} & \texttt{proton 1 1 1}\\*
    \hline
    \multicolumn{3}{|>{\raggedright}p{\textwidth}|}{%
        The reference mass can either be provided as a value in MeV, or as a named particle.
        Currently this can only be set to ``proton''.
        This value defaults to the proton mass set in the SixTrack physical constants module in \texttt{source/constants.f90}.
        Optionally, the reference particle charge and atomic mass (A), and atomic number (Z) can be set.
        If A is set, Z must also be set.
        If only charge is set, Z is set to the same value.
        The default values are all 1 (proton).
        \index{reference particle}\index{reference mass}
    } \\*
    \hline

    \rowcolor{gray!15}
    \texttt{PDG\_YEAR} & \texttt{year(int)} & \texttt{2002}\\*
    \hline
    \multicolumn{3}{|>{\raggedright}p{\textwidth}|}{%
        This can be used to set the PDG year to use for the mass if a name is provided in \texttt{REF\_PARTICLE}.
        The default value is the 2002 proton mass, the other value currently supported is 2018.
        More will be added in the future.
        Note that this value affects how the proton radius is calculated as it uses the PDG year to select the relevant constant for calculating this.
        Even when setting a reference particle mass in MeV, the PDG year is used for this.
        \index{reference particle}\index{PDG}\index{proton radius}
    } \\*
    \hline

    \rowcolor{blue!15}
    \multicolumn{3}{|c|}{\textbf{Lattice and Optics}}\\*
    \hline

    \rowcolor{gray!15}
    \texttt{LATTICE} & \texttt{thin|thick 4D|6D} & \texttt{thin 4D} \\*
    \hline
    \multicolumn{3}{|>{\raggedright}p{\textwidth}|}{%
        The first argument must be either \texttt{thick} or \texttt{thin}, and this must match the content of the geometry file.
        The second argument must be either \texttt{4D} or \texttt{6D}.
        These arguments are not case sensitive.
        When 6D tracking is requested, closed orbit and optical functions at the starting point are calculated using the differential algebra package.
        \index{thick tracking}\index{thin tracking}\index{4D}\index{6D}
    } \\*
    \hline

    \rowcolor{gray!15}
    \texttt{OPTICS} & \texttt{first(int) last(int)} & \texttt{1 nblz} \\*
    \hline
    \multicolumn{3}{|>{\raggedright}p{\textwidth}|}{%
        Start and stop structure element index for optics calculation.
        If set to 0 or omitted, the optics calculation defaults to the full machine.
        \index{optics calculation}
    } \\*
    \hline

    \rowcolor{blue!15}
    \multicolumn{3}{|c|}{\textbf{Closed Orbit}}\\*
    \hline

    \rowcolor{gray!15}
    \texttt{6D\_CLORB} & \texttt{on|off} & \texttt{off} \\*
    \hline
    \multicolumn{3}{|>{\raggedright}p{\textwidth}|}{%
        Compute the 6D closed orbit.
        If the simulation is running 4D, this option is ignored.
        \index{closed orbit}
    } \\*
    \hline

    \rowcolor{gray!15}
    \texttt{INIT\_CLORB} & \texttt{on|off} & \texttt{off} \\*
    \hline
    \rowcolor{gray!15}
    \texttt{INIT\_CLORB} & \texttt{x xp y yp [sigma dpsv] (float)} & \texttt{6 * 0.0} \\*
    \hline
    \multicolumn{3}{|>{\raggedright}p{\textwidth}|}{%
        Initialise closed orbit.
        This keyword can be called either with a flag, in which case it turns on or off the reading of a closed orbit suggestion from file \texttt{fort.33}, or it can provide 4 or 6 values for the closed orbit suggestion.
        If omitted, the values are initialised to zero, and the 4D closed orbit is used to seed the first four values of the 6D closed orbit.
        These settings are ignored when running in 4D.
        \index{closed orbit}\index{6D}
    } \\*
    \hline

    \rowcolor{blue!15}
    \multicolumn{3}{|c|}{\textbf{Particle and Track Files}}\\*
    \hline

    \rowcolor{gray!15}
    \texttt{READ\_FORT13} & \texttt{on|off} & \texttt{off} \\*
    \hline
    \multicolumn{3}{|>{\raggedright}p{\textwidth}|}{%
        Read the particle distribution from file \texttt{fort.13}.
        This file is not intended for reading an initial distribution, but for continuing tracking from a previous simulation from a \texttt{fort.12} file.

        Note that if the file is used as an input file for the initial distribution, the closed orbit is not added, even if requested with the \texttt{ADD\_CLORB} flag.
        \index{fort.13}\index{fort.12}
    } \\*
    \hline

    \rowcolor{gray!15}
    \texttt{WRITE\_FORT12} & \texttt{interval(int)} & \texttt{10000} \\*
    \hline
    \multicolumn{3}{|>{\raggedright}p{\textwidth}|}{%
        How often, in terms of turns, to write the particle distribution to file \texttt{fort.12}.
        This file can be renamed to \texttt{fort.13} and used as an input file for continued tracking.
        \index{fort.13}\index{fort.12}
    } \\*
    \hline

    \rowcolor{gray!15}
    \texttt{WRITE\_TRACKS} & \texttt{interval(int) [rewind(flag)]} & \texttt{nturn+1 on} \\*
    \hline
    \multicolumn{3}{|>{\raggedright}p{\textwidth}|}{%
        How often, in terms of turns, to write to the tracking files on unit 90 and lower (see Appendix~\ref{Files}).
        The optional \texttt{rewind} flag specifies whether or not to rewind the tracking files on each write.
        \index{singletrackfile}\index{trackfiles}
    } \\*
    \hline

    \rowcolor{blue!15}
    \multicolumn{3}{|c|}{\textbf{Various Flags and Options}}\\*
    \hline

    \rowcolor{gray!15}
    \texttt{EXACT} & \texttt{on|off} & \texttt{off} \\*
    \hline
    \multicolumn{3}{|>{\raggedright}p{\textwidth}|}{%
        Switch to enable exact solution of the equation of motion into tracking and 6D (no 4D) optics calculations.
        \begin{equation*}
            \mbox{\texttt{off:}}
            \quad x^\prime \simeq \frac{P_x}{P_0(1+\delta)},
            \quad y^\prime \simeq \frac{P_y}{P_0(1+\delta)};
        \end{equation*}
        \begin{equation*}
            \mbox{\texttt{on:}}
            \quad x^\prime \simeq \frac{P_x}{P_0\sqrt{(1+\delta)^2-P_x^2-P_y^2}},
            \quad y^\prime \simeq \frac{P_y}{P_0\sqrt{(1+\delta)^2-P_x^2-P_y^2}}.
        \end{equation*}
        \index{equation of motion}
    } \\*
    \hline

    \rowcolor{gray!15}
    \texttt{CURVEFF} & \texttt{on|off} & \texttt{off} \\*
    \hline
    \multicolumn{3}{|>{\raggedright}p{\textwidth}|}{%
        Enable or disable the effect of the curvature in a combined function magnet (bending + quadrupole).
        Note that the weak focusing effect is always included.
        \index{curve effect}\index{combined function magnet}
    } \\*
    \hline

\end{longtable}
\end{center}

% ================================================================================================================================ %
\section{Tracking Parameters} \label{TraPar}

All tracking parameters are defined with this input block.\index{tracking}\index{TRAC}
The initial coordinates are generally also set here.
A fine tuning of the initial condition is done with \textit{Initial Coordinates} block (\ref{IniCoo}), and the parameters for the synchrotron oscillation are given in block (\ref{SynOsc}).

\bigskip
\begin{tabular}{@{}llp{0.7\linewidth}}
    \textbf{Keyword}    & \texttt{TRAC}\index{TRAC} &\\
    \textbf{Data lines} & 3 &\\
    \textbf{Format}     & Line 1: & \texttt{numl numlr napx amp(1) amp0 ird imc} \\
                        &         & \texttt{niu(1) niu(2) numlcp numlmax} \\
                        & Line 2: & \texttt{idy(1) idy(2) idfor irew iclo6} \\
                        & Line 3: & \texttt{nde(1) nde(2) nwr(1) nwr(2) nwr(3) nwr(4)} \\
                        &         & \texttt{ntwin ibidu iexact curveff}
\end{tabular}

\paragraph{Format Description}~

\bigskip
\begin{longtabu}{@{}llp{0.7\linewidth}}
    \texttt{numl}          & integer  & Number of turns in the forward direction\index{turn}. \\
    \texttt{numlr}         & integer  & Number of turns in the backward direction\index{reverse turn}. \\
    \texttt{napx}          & integer  & Number of amplitude variations (i.e.\ particle pairs)\index{particle pairs}. \\
    \texttt{amp(1),amp0}   & floats   & Start and end amplitude (any sign) in the horizontal phase space plane for the amplitude variations. The vertical amplitude is calculated using the ratio between the horizontal and vertical emittance set in the \textit{Initial Coordinates} block (\ref{IniCoo}), where the initial phase in phase space are also set. Additional information can be found in the \textit{Remarks}. \\
    \texttt{imc}           & integer  & Number of variations of the relative momentum deviation\index{momentum deviations} has been removed. This value must be 1.\\
    \texttt{niu(1),niu(2)} & integer  & Start and stop structure element index for optics calculation. If 0, defaults to the full machine. \\
    \texttt{numlcp}        & integer  & Checkpoint/restart\index{checkpoint/restart} version: How often to write checkpointing files. \\
    \texttt{numlmax}       & integer  & No longer in use. \\
    \texttt{idz(1),idz(2)} & integers & A tracking where one of the transversal motion planes shall be ignored is only possible when all coupling terms are switched off. The part of the coupling that is due to closed orbit and other effects can be turned off with these switches. \\
                           &          & \texttt{idz(1), idz(2) = 1}: coupling on. \\
                           &          & \texttt{idz(1), idz(2) = 0}: coupling to the horizontal and vertical motion plane respectively switched off. \\
    \texttt{idfor}         & integer  & Usually the closed orbit is added to the initial coordinates. This can be turned off using \texttt{idfor}, for instance when a run is to be prolonged. \\
                           &          & \texttt{idfor = 0}: closed orbit added. \\
                           &          & \texttt{idfor = 1}: initial coordinates\index{initial coordinates} unchanged. \\
                           &          & \texttt{idfor = 2}: prolongation of a run, taken the initial coordinates from \texttt{fort.13}\index{fort.15}. \\
    \texttt{irew}          & integer  & To reduce the amount of tracking data after each amplitude and relative momentum deviation iteration $\Delta p/p_0$ the binary output units 90 and lower (see Appendix~\ref{Files}) are rewound. This is always done when the post-processing is activated (\ref{PosPro}). For certain applications it may be useful to store all data. The switch \texttt{irew} allows for that. \\
                           &          & \texttt{irew = 0}: unit 90 (and lower) rewound. \\
                           &          & \texttt{irew = 1}: all data on unit 90 (and lower). \\
    \texttt{iclo6}         & integer  & This switch allows to calculate the 6D closed orbit and optical functions at the starting point, using the differential algebra package. It is active in all versions that link to the Differential Algebra package.  Note that \texttt{iclo6 > 0} is mandatory for 6D simulations, and that \texttt{iclo6 = 0} is mandatory for 4D simulations. \\
                           &          & \texttt{iclo6 = 0}: switched off. \\
                           &          & \texttt{iclo6 = 1}: calculated. \\
                           &          & \texttt{iclo6 = 2}: calculated and added to the initial coordinates (\ref{IniCoo}). \\
                           &          & \texttt{iclo6 = 5 or 6}: like for 1 and 2, but in addition a guess closed orbit is read (in free format) from file \texttt{fort.33}. \\
    \texttt{nde(1)}        & integer  & Number of turns at flat bottom, useful for energy ramping. \\
    \texttt{nde(2)}        & integer  & Number of turns for the energy ramping. \texttt{numl}-\texttt{nde(2)} gives the number of turns on the flat top. For constant energy with \mbox{$nde(1) = nde(2) = 0$} the particles are considered to be on the flat top. \\
    \texttt{nwr(1)}        & integer  & Every \texttt{nwr(1)}'th turn the coordinates will be written on unit 90 (and lower) in the flat bottom part of the tracking. \\
    \texttt{nwr(2)}        & integer  & Every \texttt{nwr(2)}'th turn the coordinates in the ramping region will be written on unit 90 (and lower). \\
    \texttt{nwr(3)}        & integer  & Every \texttt{nwr(3)}'th turn at the flat top a write out of the coordinates on unit 90 (and lower) will occur. For constant energy this number controls the amount of data on unit 90 (and lower), as the particles are considered on the flat top. \\
    \texttt{nwr(4)}        & integer  & In cases of very long runs it is sometimes useful to save all coordinates for a prolongation of a run after a possible crash of the computer. Every \texttt{nwr(4)}'th turn the coordinates are written to unit 6. \\
    \texttt{ntwin}         & integer  & For the analysis of the Lyapunov exponent\index{Lyapunov exponent} it is usually sufficient to store the calculated distance of phase space together with the coordinate of the first particle (\texttt{ntwin} set to one). You may want to improve the 6D calculation of the distance in phase space with \texttt{sigcor, dpscor} (see~\ref{IniCoo}) when the 6D closed orbit is not calculated with \texttt{iclo6} $\neq 2$. If storage space is no problem, one can store the coordinates of both particles (\texttt{ntwin} set to two). The distance in phase space is then calculated in the post-processing procedure (see~\ref{PosPro}). This also allows a subsequent refined Lyapunov analysis using differential algebra and Lie algebra\index{Lie algebra} techniques (\cite{Refine}). \\
    \texttt{ibidu}         & integer  & No longer in use. Value ignored. \\
    \texttt{iexact}        & integer  & Switch to enable exact solution of the equation of motion into tracking and 6D (no 4D) optics calculations. \\
                           &          & \texttt{iexact = 0}: approximated equation
                           \begin{equation*}
                                \mbox{e.g.}
                                \quad x^\prime \simeq \frac{P_x}{P_0(1+\delta)},
                                \quad y^\prime \simeq \frac{P_y}{P_0(1+\delta)};
                           \end{equation*} \\
                           &          & \texttt{iexact = 1}: exact equation
                           \begin{equation*}
                                \mbox{e.g.}
                                \quad x^\prime \simeq \frac{P_x}{P_0\sqrt{(1+\delta)^2-P_x^2-P_y^2}},
                                \quad y^\prime \simeq \frac{P_y}{P_0\sqrt{(1+\delta)^2-P_x^2-P_y^2}}.
                           \end{equation*} \\
    \texttt{curveff}       & integer  & \texttt{curveff = 0}: the effect of the curvature in a combined function is neglected. Note that the weak focusing effect is always included. \\
                           &          & \texttt{curveff = 1}: switch to enable the curvature effect in a combined function magnet (bending + quadrupole).
\end{longtabu}

\paragraph{Remarks}~
\begin{enumerate}
    \item This input data block is usually combined with the \textit{Initial Coordinates}\index{INIT} input block (\ref{IniCoo}) to allow a flexible choice of the initial coordinates for the tracking.
    \item For a prolongation of a run the following parameters have to be set:
    \begin{enumerate}
        \item in this input block: \texttt{idfor = 1}
        \item in the \textit{Initial coordinates} input block:
        \begin{itemize}
            \item \texttt{itra = 0}
            \item take the end coordinates of the previous run as the initial coordinates (including all digits) for the new run.
        \end{itemize}
    \end{enumerate}
    \item A feature is installed for a prolongation of a run by using \texttt{idfor = 2} and reading the initial data from file \texttt{fort.13}. The end coordinates are now written to \texttt{fort.12} after each run. Intermediate coordinates are also written to \texttt{fort.12} in case the turn number \texttt{nwr(4)} is exceeded in the run. The user takes responsibility to transfer the required data from \texttt{fort.12} to \texttt{fort.13} if a prolongation is requested. This feature can be used to effectively read in a custom-made beam distribution. The format of the file is one line per pair of particles; the meaning of the columns is exactly that of the \textit{Initial Coordinates}\index{INIT} input block (see Sec.~\ref{IniCoo} and Tab.~\ref{T-IniCoo}).
    \item As of version 5.2 the particle momentum offset from \texttt{fort.13} is re-calculated from the particle energy to ensure these are consistent. The particle momentun offset in \texttt{fort.13} is therefore ignored.
    \item Some illogical combinations of parameters have been suppressed.
    \item The initial coordinates are calculated using a proper linear 6D transformation: \texttt{amp(1)} is still the maximum horizontal starting amplitude (excluding the dispersion contribution) from which the emittance of mode 1 $e_I$ is derived, \texttt{rat} (see~\ref{IniCoo}) is the ratio of $e_{II}/e_I$ of the emittances of the two modes. The momentum deviation $\frac{\Delta p}{p_{0,1}}$ is used to define a longitudinal amplitude. The 6 normalized coordinates read:
        \begin{enumerate}
            \item horizontal:\\
            \begin{equation*}
                \left[\sqrt{e_I} = \frac{\mbox{amp(1)}} {\sqrt{\beta_{xI}}+\sqrt{\left|\mbox{rat}\right|\times\beta_{xII}}}, \quad 0.0 \right]
            \end{equation*}
            \item vertical:\\
            \begin{equation*}
                \left[sign(\mbox{rat})\times \sqrt{e_{II}} \mbox{ with } e_{II} = \left|\mbox{rat}\right|\times e_{I}, \quad 0.0 \right]
            \end{equation*}
            \item longitudinal:\\
            \begin{equation*}
                \left[0.0, \quad \frac{\Delta p}{p_{0,1}} \times \sqrt{\beta_{sIII}} \right]
            \end{equation*}
        \end{enumerate}
        and are then transformed with the 6D linear transformation into real space. Note that results may differ from those of older versions.
    \item The amplitude scan is performed from \texttt{amp(1)} to \texttt{amp0} in steps of $\mbox{delta} = (\mbox{amp0} - \mbox{amp(1)}) / (napx-1)$. For the intermediate amplitudes, \texttt{delta} is added up for each step, however the last amplitude is guaranteed to be fixed to the given value. This enables ``control calculations'' by setting the first amplitude of one simulation equal to the last amplitude of another simulation, and unless there are calculation errors, they shall produce exactly the same results.
    \item Note that if \texttt{iclo6 = 2} and \texttt{idfor = 0} in the input file, then \texttt{idfor} is internally set to 1, as is seen in some outputs. This does not mean that the closed orbit is not added; the setting of \texttt{iclo6 = 2} simply takes precedence.
\end{enumerate}

% ================================================================================================================================ %
\section{Initial Coordinates} \label{IniCoo}

The \textit{Initial Coordinates} input block is meant to manipulate how the initial coordinates are organise, which are generally set in the tracking parameter block (\ref{TraPar}).\index{initial coordinates}\index{INIT}
Number of particles\index{particle pairs}, initial phase, ratio of the horizontal and vertical emittances and increments of \mbox{2 $\times$ 6} coordinates of the two particles, the reference energy and the starting energy for the two particles.

\bigskip
\begin{tabular}{@{}llp{0.7\linewidth}}
    \textbf{Keyword}    & \texttt{INIT}\index{INIT} \\
    \textbf{Data lines} & 16 \\
    \textbf{Format}     & Line 1: \texttt{itra chi0 chid rat iver} \\
                        & Lines 2 to 16: 15 initial coordinates as listed in Table~\ref{T-IniCoo}
\end{tabular}

\paragraph{Format Description}~

\bigskip
\begin{longtabu}{@{}llp{0.7\linewidth}}
    \texttt{itra} & integer  & Number of particles: \\
                  &          & \texttt{itra = 0}: Amplitude values of tracking parameter block (\ref{TraPar}) are ignored and coordinates of data line 2--16 are taken. \texttt{itra} is set internally to 2 for tracking with two    particles. This is necessary in case a run is to be prolonged. \\
                  &          & \texttt{itra = 1}: Tracking of one particle, twin particle ignored. \\
                  &          & \texttt{itra = 2}: Tracking the two twin particles. \\
    \texttt{chi0} & float    & Starting phase of the initial coordinate in the horizontal and vertical phase space projections. \\
    \texttt{chid} & float    & Phase difference between first and second particles. \\
    \texttt{rat}  & float    & Denotes the emittance ratio ($e_{II}/e_I$) of horizontal and vertical motion. For further information see the \emph{Remarks} of the \texttt{TRAC} input block in Section~\ref{TraPar}. \\
    \texttt{iver} & integer  & In tracking with coupling it is sometimes desired to start with zero vertical amplitude which can be painful if the emittance ratio \texttt{rat} is used to achieve it. For this purpose the switch \texttt{iver} has been introduced: \\
                  &          & \texttt{iver = 0}: Vertical coordinates unchanged. \\
                  &          & \texttt{iver = 1}: Vertical coordinates set to zero.
\end{longtabu}

\begin{table}[h]
    \caption{Initial Coordinates of the 2 Particles}
    \label{T-IniCoo}
    \centering
    \begin{tabular}{|l|l|}
        \hline
        \rowcolor{blue!30}
        Line & Contents \\
        \hline
        2 & $x_1$ [mm] coordinate of particle 1 \\
        \hline
        3 & $x'_1$ [mrad] coordinate of particle 1 \\
        \hline
        4 & $y_1$ [mm] coordinate of particle 1 \\
        \hline
        5 & $y'_1$ [mrad] coordinate of particle 1 \\
        \hline
        6 & path length difference 1 ($\sigma_1 = s - v_0 \times t$) [mm] of particle 1 \\
        \hline
        7 & $\Delta p/p_{0,1} $ of particle 1 \\
        \hline
        8 & $x_2$ [mm] coordinate of particle 2 \\
        \hline
        9 & $x'_2$ [mrad] coordinate of particle 2 \\
        \hline
        10 & $y_2$ [mm] coordinate of particle 2 \\
        \hline
        11 & $y'_2$ [mrad] coordinate of particle 2 \\
        \hline
        12 & path length difference ($ \sigma_2 = s - v_0 \times t$) [mm] of particle 2 \\
        \hline
        13 & $\Delta p/p_{0,2}$ of particle 2 \\
        \hline
        14 & energy [MeV] of the reference particle\index{reference energy} \\
        \hline
        15 & energy [MeV] of particle 1 \\
        \hline
        16 & energy [MeV] of particle 2 \\
        \hline
    \end{tabular}
\end{table}

\paragraph{Remarks}~
\begin{itemize}
    \item These 15 coordinates are taken as the initial coordinates if \texttt{itra} is set to zero (see above). If \texttt{itra} is 1 or 2 these coordinates are added to the initial coordinates generally defined in the tracking parameter block (\ref{TraPar}). This procedure seems complicated but it allows freely to define the initial difference between the two twin particles. It also allows in case a tracking run should be prolonged to continue with precisely the same coordinates. This is important as small difference may lead to largely different results.
    \item The reference particle is the particle in the centre of the bucket which performs no synchrotron oscillations.
    \item The energy of the first and second particles is given explicitly, again to make possible a continuation that leads precisely to the same results as if the run would not have been interrupted.
    \item There is a refined way of prolonging a run, see the \textit{Tracking Parameters} input block (\ref{TraPar}).
\end{itemize}

% ================================================================================================================================ %
\section{Synchrotron Oscillation} \label{SynOsc}

The parameters needed for treating the synchrotron oscillation in a symplectic manner are given in the \textit{Synchrotron Oscillation} input block.\index{synchrotron oscillation}\index{SYNC}

\bigskip
\begin{tabular}{@{}llp{0.7\linewidth}}
    \textbf{Keyword}    & \texttt{SYNC}\index{SYNC} \\
    \textbf{Data lines} & 2 \\
    \textbf{Format}     & Line 1: \texttt{harm alc u0 phag tlen pma ition dppoff} \\
                        & Line 2: \texttt{dpscor sigcor}
\end{tabular}

\paragraph{Format Description}~

\bigskip
\begin{longtabu}{@{}llp{0.65\linewidth}}
    \texttt{harm}   & integer & Harmonic number\index{harmonic number}. \\
    \texttt{alc}    & float   & Momentum compaction\index{momentum compactions} factor, used here only to calculate the linear synchrotron tune $Q_{S}$. \\
    \texttt{u0}     & float   & Circumference voltage\index{circumference voltage} in [MV]. \\
    \texttt{phag}   & float   & Acceleration phase\index{acceleration phase} in degrees. \\
    \texttt{tlen}   & float   & Length of the accelerator\index{accelerator length} in meters. \\
    \texttt{pma}    & float   & Rest mass\index{rest mass} of the particle in $\mathrm{MeV}/\mathrm{c}^{2}$. \\
    \texttt{ition}  & integer & Transition energy switch\index{transition energy}: \\
                    &         & \texttt{ition = 0}: for no synchrotron oscillation (energy ramping still possible). \\
                    &         & \texttt{ition = 1}: for above transition energy. \\
                    &         & \texttt{ition = -1}: for below transition energy. \\
    \texttt{dppoff} & float   & Offset Relative Momentum Deviation\index{relative momentum deviation} $\Delta p/p_0$: a fixpoint with respect to synchrotron oscillations. It becomes active when the 6D closed orbit is calculated (see item \texttt{iclo6} in section~\ref{TraPar}). \\
    \texttt{dpscor,sigcor} & floats & Scaling factor for relative momentum deviation $\Delta p/p_0$ and the path length difference ($\sigma = s - v_0 \times t$) respectively. They can be used to improve the calculation of the 6D distance in phase space, but is only used when \texttt{ntwin = 1} in the tracking parameter input block~(\ref{TraPar}). Please set to 1 when the 6D closed is calculated.
\end{longtabu}

\textbf{Note:} The value of \texttt{tlen} is also calculated internally by SixTrack (in \texttt{dcum}\index{dcum}), and a warning is issued if the given value is different from the calculated value.

% ================================================================================================================================ %
\section{Tracking with Ions} \label{hions}

The default tracking in SixTrack is for protons.
In case tracking of ions is wanted the following input block should be used.\index{ion tracking}
The \texttt{HION} block only specifies the reference particle.
By default, all particles are initialised to the same values, but if multiple ion species are needed, these can be provided by an input file in the \texttt{DIST} block.

\bigskip
\begin{tabular}{@{}llp{0.7\linewidth}}
    \textbf{Keyword}    & \texttt{HION}\index{HION} \\
    \textbf{Data lines} & 1 \\
    \textbf{Format}     & Line 1: \texttt{A Z $m_a$ Q}
\end{tabular}

\paragraph{Format Description}~

\bigskip
\begin{longtabu}{@{}llp{0.65\linewidth}}
    \texttt{A}     & integer & Total number of nucleons (atomic mass number). \\
    \texttt{Z}     & integer & Total number of protons. \\
    \texttt{$m_a$} & float   & Mass of the ion [GeV/$c^2$]. \\
    \texttt{Q}     & integer & Electrical charge.
\end{longtabu}

% ================================================================================================================================ %
\section{Initial Distribution from an ASCII file} \label{distBlock}

In addition to \texttt{fort.13} (see \emph{Tracking Parameters} input block, Sec.~\ref{TraPar}), it is possible to read a beam distribution from a plain ASCII file via the \texttt{DIST} block.
With respect to using \texttt{fort.13}, which basically specifies just the six particle coordinates for each pair of particles, the \texttt{DIST} block allows the user to specify further properties of the particles, like charge or mass, necessary in case of species different than the synchronous one.
There is also the possibility to echo the parsed information into a plain ASCII file.
The echo of the distribution takes place after all the arrays for longitudinal motion have been updated and after the closed orbit is applied, if requested by the user.

\bigskip
\begin{tabular}{@{}llp{0.7\linewidth}}
    \textbf{Keyword}    & \texttt{DIST}\index{DIST} \\
    \textbf{Data lines} & Variable \\
    \textbf{Format}     & Keyword/value
\end{tabular}

\paragraph{Format Description}~

Table~\ref{tab:distKeys} reports the available keywords and meaning of necessary values. The user has to specify the file from which the code should read the distribution; in case the user wants the echo of the read distribution, they need to specify a name as well.

Table~\ref{tab:distReadFileColumns} shows the format of the ASCII file from where the beam distribution is read, along with meaning of columns and units when necessary.
All particles must be listed, one per line.
No header is required.
Similarly, Tab.~\ref{tab:distEchoFileColumns} shows the format of the ASCII file where the read beam distribution is echoed, along with meaning of columns and units when necessary.
As for the file for reading the distribution, one particle per line is dumped.
A header is dumped as well.


\bigskip
\begin{center}
\begin{longtable}{|c|c|l|}%{|p{2.0cm} | p{1.2cm} | p{1.0cm} | p{9.0cm}|}
    %Note: \\* (with the star) used to inhibit page breaks in the middle of groups of the same type
    \caption{Keywords and values available in the \texttt{DIST} block. Keywords are listed in alphabetical order.}
    \label{tab:distKeys} \\*
    \hline
    \rowcolor{blue!30}
    Keyword & Value & Description \\*
    \hline
    \endfirsthead
    \texttt{READ} & filename & ASCII file from where the code will read the desired distribution \\*
    \hline
    \texttt{ECHO} & filename & ASCII file where the echo of the distribution should be saved \\*
    \hline
\end{longtable}
\end{center}

\begin{center}
\begin{longtable}{|l|l|}%{|p{2.0cm} | p{1.2cm} | p{1.0cm} | p{9.0cm}|}
    %Note: \\* (with the star) used to inhibit page breaks in the middle of groups of the same type
    \caption{Format of the ASCII file containing the distribution to be read by the \texttt{DIST} block.}
    \label{tab:distReadFileColumns} \\*
    \hline
    \rowcolor{blue!30}
    \# & Description \\*
    \hline
    \endfirsthead
    1  & particle id (not actually used) \\*
    2  & parent particle id (not actually used) \\*
    3  & statistical weight (not actually used) \\*
    4  & $x$ [m] \\*
    5  & $y$ [m] \\*
    6  & $z$ (unused) \\*
    7  & $x'$ [1e-3] \\*
    8  & $y'$ [1e-3] \\*
    9  & $z'$ (unused) \\*
    10 & mass number \\*
    11 & atomic number \\*
    12 & mass [GeV/c$^2$] \\*
    13 & linear momentum [GeV/c] \\*
    14 & time lag [s] \\*
    \hline
\end{longtable}
\end{center}
\begin{center}
\begin{longtable}{|l|l|l|}
    %Note: \\* (with the star) used to inhibit page breaks in the middle of groups of the same type
    \caption{The format of the ASCII file where the distribution read by the \texttt{DIST} block is echoed. See also Table~\ref{tab:sixtrackunits} in \texttt{DUMP} for a more detailed description of the variables.}
    \label{tab:distEchoFileColumns} \\*
    \hline
    \rowcolor{blue!30}
    \# & Variable & Unit\\*
    \hline
    \endfirsthead
    1  & \texttt{xv1}   & [mm]    \\*
    2  & \texttt{yv1}   & [1e-3]  \\*
    3  & \texttt{xv2}   & [mm]    \\*
    4  & \texttt{yv2}   & [1e-3]  \\*
    5  & \texttt{sigmv} & [mm]    \\*
    6  & \texttt{ejfv}  & [MeV/c] \\*
    \hline
\end{longtable}
\end{center}

